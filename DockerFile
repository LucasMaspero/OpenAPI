# Node & Java Base
FROM timbru31/java-node

# Step 1: Install Node Packages
WORKDIR /.
COPY . .
RUN npm install

# Step 2: Validate Specification File
RUN npm run validate-spec

# Step 3: Generate .NET Core API Service Stubs
RUN npm run generate-service-dotnetcore
    
# DotNet Base & Copying files between stages
FROM mcr.microsoft.com/dotnet/core/sdk:3.1
COPY --from=0 . .

# Step 4: Build .NET Core API Service Stubs
WORKDIR /Output/SecurityService/NetCore/src/Org.OpenAPITools
RUN dotnet build

# Step 5: Create NuGet Package from Service Stubs
RUN dotnet pack